---
sqlpage-conf:
  database_url: "sqlite://tem.sqlite.db?mode=rwc"
  web_root: "./dev-src.auto"
  allow_exec: true
  port: 9228
---

```code DEFAULTS
sql * --interpolate --injectable
```

## Opsfolio EAA Results Unit Test

This section defines the SQLPage routes for the Opsfolio EAA Results Unit Test
UI and matches the layout shown in the screenshot.

### Ingest CSV Catalog into sqlite.db

### Ingest Security Standard Catalog into sqlite.db

```bash catalog --descr "To add NIST, OWASP, CWE, and MITRE ATT&CK security standards to the database."
#!/usr/bin/env bash
#  surveilr ingest files -r security_standards.csv  --csv-transform-auto -d tem.sqlite.db 
```

<!-- ### Ingest Interpretations into sqlite.db -->

<!-- ```bash ingest --descr "Use Surveilr to ingest EAA and Interpretation results into SQLite."
#!/usr/bin/env bash
surveilr ingest files -r interpretation -d tem.sqlite.db
``` -->

### Ingest SQL Views from stateless.sql into sqlite.db

```bash sql_views --descr "Load SQL views from stateless.sql"
#!/usr/bin/env bash
cat stateless.sql | sqlite3 tem.sqlite.db
```

### Ingest SQL Query from Spryfile.md into sqlite.db

```bash sql_query --descr "Run using spry."
#!/usr/bin/env bash
spry sp spc --package --conf sqlpage/sqlpage.json -m Spryfile.md | sqlite3 tem.sqlite.db
```

### View the sqlite.db Locally Using Surveilr

```bash surveilr --descr "View via Surveilr web UI."
#!/usr/bin/env bash
surveilr web-ui -d tem.sqlite.db
```

### Access the Web UI

Use the following command to start the local Web UI and open it in your browser:

```bash site_url --descr "Start the Web UI locally"
#!/usr/bin/env bash
echo "Visit http://localhost:9228"
```

```contribute sqlpage_files --base sqlpage/templates --mode package
**/* templates --mime text/plain
```

```contribute sqlpage_files --base .
./custom.css .
./modal-close.js .
./rich_text_editor.js .
./print-report.js .
```

## Opsfolio EAA Results Unit Test Home Page

Index page which automatically generates links to all
`/tem pages.`navigation_node` is automatically generated by Spry.

```sql PARTIAL global-layout.sql --inject *.sql --inject !/^interpretation/
-- ============================
-- Persist Tenant / Session
-- ============================

SELECT 'cookie' AS component, 'Tenant' AS name, :Tenant AS value
WHERE NULLIF(:Tenant,NULL) IS NOT NULL;

SELECT 'cookie' AS component, 'Session' AS name, :Session AS value
WHERE NULLIF(:Session,NULL) IS NOT NULL;

SELECT
    'cookie' AS component,
    'uniform_resource_id' AS name,
    @uid AS value
WHERE @uid IS NOT NULL;


-- BEGIN: PARTIAL global-layout.sql
SELECT 'shell' AS component,
        NULL AS title,
        NULL AS icon,
       'https://raw.githubusercontent.com/opsfolio/assets-public/refs/heads/main/opsfolio-branding/sub-brands/surveilr-patterns/icons/fleetfolio/fleetfolio.ico' AS favicon,
       'https://raw.githubusercontent.com/opsfolio/assets-public/refs/heads/main/opsfolio-branding/sub-brands/surveilr-patterns/logos/fleetfolio/fleetfolio-logo-primary.png' AS image,
       'fluid' AS layout,
       true AS fixed_top_menu,
       'index.sql' AS link,
       '/custom.css' as css,
       '/modal-close.js' as javascript_module,
       '/rich_text_editor.js' as javascript_module,
       '/print-report.js' as javascript_module,
       '¬© 2026 Fleetfolio. Built on [surveilr](https://www.surveilr.com/), the evidence substrate.' as footer;

SET resource_json = sqlpage.read_file_as_text('spry.d/auto/resource/${path}.auto.json');
SET page_title  = json_extract($resource_json, '$.route.caption');
SET page_path = json_extract($resource_json, '$.route.path');
${ctx.breadcrumbs()}

select 
    'form' as component,
    'select-end' as class,
     TRUE  as auto_submit;

SELECT 
    'select' as type,
    'Tenant' as name,
    'Boundaries' as label,
    'Select Boundaries' as empty_option,
    COALESCE(:Tenant, sqlpage.cookie('Tenant')) as value,
    2 as width,
    json_group_array(
        json_object(
            'label', tenant,
            'value', tenant_id
        )
    ) as options
FROM (
    SELECT DISTINCT tenant, tenant_id
    FROM tenant_session
);


SELECT 
    'select' as type,
    'Select Session' as empty_option,
    'Session' as name,
    COALESCE(:Session,sqlpage.cookie('Session')) as value,
    2  as width,
    json_group_array(json_object(
        'label', session,
        'value', session
    )) as options
FROM tenant_session
WHERE tenant_id = COALESCE(:Tenant, sqlpage.cookie('Tenant'));

SELECT 
    'button' as component,
    'end' as justify
WHERE 
    NULLIF(COALESCE(:Tenant, sqlpage.cookie('Tenant')), '') IS NOT NULL
AND NULLIF(COALESCE(:Session, sqlpage.cookie('Session')), '') IS NOT NULL

SELECT 
    '#penetration_modal' as link,
    'pentest-print-btn' as id,
    'eye' as icon,
    'green as 'color,
    'View Pentest Report' as title
WHERE 
    NULLIF(COALESCE(:Tenant, sqlpage.cookie('Tenant')), '') IS NOT NULL
AND NULLIF(COALESCE(:Session, sqlpage.cookie('Session')), '') IS NOT NULL

    select 
    'modal'            as component,
    'penetration_modal'      as id,
    'penetration_modal_custom' as class,
    TRUE as large,
   '/interpretation/penetration-report.sql' as embed;

```

```sql index.sql { route: { caption: "Home" } }

SET routes_json = sqlpage.read_file_as_text('spry.d/auto/route/forest.auto.json');
SET root_path   = '/threatmanagement';

SELECT 'card' AS component, '' AS title, 1 AS columns;
SELECT
  IFNULL(json_extract(c.value,'$.payloads[0].caption'),
         json_extract(c.value,'$.basename'))                         AS title,
  json_extract(c.value,'$.payloads[0].description')                  AS description_md,
  json_extract(c.value,'$.path')                                     AS link
FROM json_each(
       json_extract(
         (SELECT jt.value
          FROM json_tree(json($routes_json)) AS jt
          WHERE jt.type='object'
            AND json_extract(jt.value,'$.path') = $root_path
          LIMIT 1),
         '$.children'
       )
     ) AS c
WHERE IFNULL(json_extract(c.value,'$.virtual'), 0) <> 1;

select 
    'divider'            as component,
    'fs-3'  as class,
    'Threat Management' as contents,
    'blue'               as color;

SELECT
    'card' AS component,
    'card-custom' as class,
    4            AS columns;
 
-- Total Issues
SELECT
    'Total Number of Issues' AS title,
     CAST(COALESCE(SUM(s.total), 0) AS TEXT) AS description_md,
    'black'                 AS color,
    '/tools/findings.sql?totalIssues=issues' AS link,
    'list-check'            AS icon
FROM (SELECT 1) AS anchor
LEFT JOIN severity_issue_count s
  ON s.severity IN ('critical','high','medium','low')
 AND s.tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND s.session =  COALESCE(:Session,sqlpage.cookie('Session'));

 
 
-- Critical Issues
SELECT
    'Critical Issues' AS title,
     CAST(COALESCE(SUM(s.total), 0) AS TEXT) AS description_md,
     'red'  AS color,
     '/tools/findings.sql?priority=critical' AS link,
    'alert-triangle'  AS icon
FROM (SELECT 1) AS anchor
LEFT JOIN severity_issue_count s
  ON s.severity = 'critical'
 AND s.tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND s.session =  COALESCE(:Session,sqlpage.cookie('Session'));
 
-- High Issues
SELECT
    'High Issues' AS title,
     CAST(COALESCE(SUM(s.total), 0) AS TEXT) AS description_md,
    'orange'  AS color,
     '/tools/findings.sql?priority=high' AS link,
    'hourglass-high'    AS icon
FROM (SELECT 1) AS anchor
LEFT JOIN severity_issue_count s
  ON s.severity = 'high'
 AND s.tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND s.session =  COALESCE(:Session,sqlpage.cookie('Session'));
 
 
-- Medium Issues
SELECT
    'Medium Issues' AS title,
     CAST(COALESCE(SUM(s.total), 0) AS TEXT) AS description_md,
    'yellow'  AS color,
     '/tools/findings.sql?priority=medium' AS link,
    'brand-medium'  AS icon
FROM (SELECT 1) AS anchor
LEFT JOIN severity_issue_count s
  ON s.severity = 'medium'
 AND s.tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND s.session =  COALESCE(:Session,sqlpage.cookie('Session'));
 
 
-- Low Issues
SELECT
    'Low Issues' AS title,
     CAST(COALESCE(SUM(s.total), 0) AS TEXT) AS description_md,
    'blue'  AS color,
    '/tools/findings.sql?priority=low' AS link,
    'hourglass-low' AS icon
FROM (SELECT 1) AS anchor
LEFT JOIN severity_issue_count s
  ON s.severity = 'low'
 AND s.tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND s.session =  COALESCE(:Session,sqlpage.cookie('Session'));

-- Info Issues
SELECT
    'Info Issues' AS title,
     CAST(COALESCE(SUM(s.total), 0) AS TEXT) AS description_md,
    'secondary'  AS color,
    '/tools/findings.sql?priority=info' AS link,
    'info-circle' AS icon
FROM (SELECT 1) AS anchor
LEFT JOIN severity_issue_count s
  ON s.severity = 'info'
 AND s.tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND s.session =  COALESCE(:Session,sqlpage.cookie('Session'));
 
-- Fixed Issues
SELECT
    'Fixed Issues' AS title,
     CAST(COALESCE(COUNT(*), 0) AS TEXT) AS description_md,
    'green' As color,
    '/tools/findings.sql?fixed=1' AS link,
    'file-check' AS icon
FROM interpretaion_task_master WHERE status = 'remediated' 
AND tenant =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
AND session =  COALESCE(:Session,sqlpage.cookie('Session'));

-- Interpretation
SELECT
    'Interpretation' AS title,
     CAST(COALESCE(COUNT(*), 0) AS TEXT) AS description_md,
    'purple' As color,
    '/threatmanagement/interpretations.sql' AS link,
    'layers-intersect' AS icon
FROM interpretaion_task_master
WHERE tenant =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
AND session =  COALESCE(:Session,sqlpage.cookie('Session'));

--Charts
select 
    'card' as component,
    'chart-custom' as class,
    2      as columns;
select 
    'Total Issues' as title,
    '/interpretation/issue-chart.sql?color=green&n=42&_sqlpage_embed' as embed;
select 
    'Severity' AS title,
    '/interpretation/donut-chart.sql?_sqlpage_embed' as embed;

--Issue Cards
select 
    'divider'            as component,
    'fs-3' as class,
    'Tools' as contents,
    'blue'               as color;
    
SELECT
    'card' AS component,
    3 AS columns;
 
 WITH parsed AS (
  SELECT
      t.tool AS tool,
      CASE
          -- JSON severity
          WHEN json_valid(tc.result) = 1
               AND json_extract(tc.result, '$.info.severity') IS NOT NULL
          THEN lower(trim(json_extract(tc.result, '$.info.severity')))

          -- Markdown severity
          WHEN lower(tc.result) LIKE '%severity%' THEN
              CASE
                  WHEN lower(tc.result) LIKE '%critical%' THEN 'critical'
                  WHEN lower(tc.result) LIKE '%high%'     THEN 'high'
                  WHEN lower(tc.result) LIKE '%medium%'   THEN 'medium'
                  WHEN lower(tc.result) LIKE '%low%'      THEN 'low'
                  ELSE NULL
              END
          ELSE NULL
      END AS severity
  FROM eaa_tool_name t
  LEFT JOIN eaa_tool_content tc
      ON lower(tc.tool_name) = lower(t.tool)
      AND ( tc.tenant_id = COALESCE(:Tenant,sqlpage.cookie('Tenant')) )
      AND ( tc.session   = COALESCE(:Session,sqlpage.cookie('Session')))
),

data AS (
  SELECT
      tool,
      SUM(CASE WHEN severity = 'critical' THEN 1 ELSE 0 END) AS critical,
      SUM(CASE WHEN severity = 'high'     THEN 1 ELSE 0 END) AS high,
      SUM(CASE WHEN severity = 'medium'   THEN 1 ELSE 0 END) AS medium,
      SUM(CASE WHEN severity = 'low'      THEN 1 ELSE 0 END) AS low
  FROM parsed
  GROUP BY tool
)

SELECT
    'blue' AS color,
    'white' AS background_color,
    'right_align' AS class,

    ${md.link(
      "tool",
      [`'/tools/findings.sql?tool='`, "tool"]
    )} AS description_md,

    critical || '' AS description_md2,
    high     || '' AS description_md3,
    medium   || '' AS description_md4,
    low      || '' AS description_md5,
    (critical + high + medium + low) || '' AS description_md6

FROM data
ORDER BY
  CASE WHEN (critical + high + medium + low) > 0 THEN 1 ELSE 0 END DESC,
  tool;
```

```sql interpretation/issue-chart.sql { route: { caption: "Pie", layout: "fluid" } }
SELECT
  'card' AS component,
  1 AS column;

SELECT
  'chart' AS component,
  'bar' AS type;

SELECT
  'Issues' AS label,
  SUM(total) AS value,
  'black' AS color
FROM severity_issue_count
 WHERE severity IN ('critical','high','medium','low')
 AND tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant'))
 AND session =  COALESCE(:Session,sqlpage.cookie('Session'));
```

```sql interpretation/donut-chart.sql { route: { caption: "Bar", layout: "fluid" } }
SELECT
  'card' AS component,
  2 AS column;

SELECT
  'chart' AS component,
  'red'    AS color,
  'orange' AS color,
  'yellow' AS color,
  'blue' AS color,
  'red' AS color,
  'pie' AS type;

  WITH severity_order(severity, label, sort_order) AS (
  VALUES
    ('critical', 'Critical', 1),
    ('high',     'High',     2),
    ('medium',   'Medium',   3),
    ('low',      'Low',      4)
)

SELECT
  s.label AS label,
  COALESCE(SUM(c.total), 0) AS value
FROM severity_order s
LEFT JOIN severity_issue_count c
  ON c.severity = s.severity
 AND c.tenant_id = COALESCE(:Tenant, sqlpage.cookie('Tenant'))
 AND c.session   = COALESCE(:Session, sqlpage.cookie('Session'))
GROUP BY s.label, s.sort_order
ORDER BY s.sort_order;

```

```sql tools/findings.sql { route: { caption: "Tools", layout: "fluid" } }

select 
    'divider'            as component,
    'Findings' as contents,
    'fs-3' as class,
    'blue'               as color;

SELECT 
  'title' AS component, 
  COALESCE(UPPER(SUBSTR(COALESCE(@tool, ''), 1, 1)) || LOWER(SUBSTR(COALESCE(@tool, ''), 2)),NULL) || ' Findings' As contents;

  SELECT 
  'text' AS component, 
  description AS contents
  FROM eaa_tool_name 
  WHERE tool = @tool;

select 
    'modal'            as component,
    'inter_modal'      as id,
    'modal-custom'     as class,
    CASE
        WHEN NULLIF(@uid, '') IS NOT NULL
         AND EXISTS (
            SELECT 1
            FROM interpretaion_task_master t
            WHERE t.uniform_resource_id = @uid
        )
        THEN 'Edit Interpretation'
        ELSE 'Create Interpretation'
    END AS title,
    TRUE as large,
   '/interpretation/modal.sql' as embed;

select 
    'modal'            as component,
    'inter_confirm_modal'  as id,
    TRUE as small,
    'Delete Interpretation' AS title,
    '/interpretation/delete-confirmation.sql?uid=' || @uid as embed;

SELECT 'table' AS component, TRUE AS sort, 
  TRUE AS search,
 'Interp'  as markdown,
  'Raw' as markdown,
  'Action' AS markdown,
  'findings_table_class' AS class,
  'icon'  as icon;

  
${paginate("unified_tenant_finding_active")}

SELECT
  CASE
    WHEN EXISTS (
        SELECT 1
        FROM interpretaion_task_master t
        WHERE t.uniform_resource_id = unified_tenant_finding_active.uniform_resource_id
    )
    THEN
        '[1](/threatmanagement/interpretations.sql?uid=' || uniform_resource_id || ')'
    ELSE
        '0'
  END AS Interp,
  '[1](/findings/tool-content.sql?id='|| uniform_resource_id ||')' as Raw,
  CASE
    WHEN EXISTS (
        SELECT 1
        FROM interpretaion_task_master t
        WHERE t.uniform_resource_id = unified_tenant_finding_active.uniform_resource_id
    )
    THEN
        '[‚úèÔ∏è](?tool=' || tool_name || '&uid=' || unified_tenant_finding_active.uniform_resource_id ||
        CASE 
            WHEN NULLIF(@fixed, '') IS NOT NULL 
            THEN '&fixed=' || @fixed 
            ELSE '' 
        END ||
        '#inter_modal)' || ' ' ||

        '[üóëÔ∏è](?uid=' ||unified_tenant_finding_active.uniform_resource_id || '&tool=' || tool_name ||
        CASE 
            WHEN NULLIF(@fixed, '') IS NOT NULL 
            THEN '&fixed=' || @fixed 
            ELSE '' 
        END ||
        '#inter_confirm_modal)'
    ELSE
        '[‚ûï](?tool=' || tool_name || '&uid=' || unified_tenant_finding_active.uniform_resource_id ||
        CASE 
            WHEN NULLIF(@fixed, '') IS NOT NULL 
            THEN '&fixed=' || @fixed 
            ELSE '' 
        END ||
        '#inter_modal)'
  END AS action,
  tool_name as "Tool",
  asset   AS "Asset",
  asset_type   AS "Asset Type",
  asset_location AS "Asset Location",
  vulnerability_type AS "Vulnerability Type", 
  severity AS "Severity"
  FROM (
    SELECT * FROM unified_tenant_finding_active
    WHERE NULLIF(@fixed,'') IS NULL

    UNION ALL

    SELECT * FROM unified_tenant_finding
    WHERE NULLIF(@fixed,'') IS NOT NULL
) unified_tenant_finding_active

WHERE (tenant_id =  COALESCE(:Tenant,sqlpage.cookie('Tenant')))
AND (session   =  COALESCE(:Session,sqlpage.cookie('Session')))
/* FIXED filter */
AND (
    NULLIF(@fixed, '') IS NULL 
    OR EXISTS (
        SELECT 1
        FROM interpretaion_task_master t
        WHERE t.uniform_resource_id = unified_tenant_finding_active.uniform_resource_id
        AND LOWER(t.status) = 'remediated'
    )
)
AND (
    NULLIF(@tool, '') IS NULL
    OR LOWER(tool_name) = LOWER(@tool)
)

/* PRIORITY filter */
AND (
    NULLIF(@priority, '') IS NULL
    OR LOWER(severity) = LOWER(@priority)
)

/* TOTAL ISSUES filter */
AND (
    NULLIF(@totalIssues, '') IS NULL
    OR LOWER(severity) IN ('critical','high','medium','low')
)

${pagination.limit};
${pagination.navWithParams("tool","priority","totalIssues","fixed")}


```

```sql findings/tool-content.sql { route: { caption: "Tool-Content", layout: "fluid" } }

select 
    'divider'            as component,
    'fs-3' as class,
    'Raw Data' as contents,
    'blue'               as color;

SELECT
  'table' AS component
  WHERE EXISTS ( SELECT 1 FROM uniform_resource_content
        WHERE uniform_resource_id = @id AND file_type = 'json'
  );

SELECT
  tool_name   AS "Tool",
  template_id   AS "Template ID",
  template_path AS "Template Path",
  name          AS "Name",
  severity      AS "Severity",
  host          AS "Host",
  url           AS "URL",
  matched_at    AS "Matched At"
FROM uniform_resource_content
WHERE uniform_resource_id = @id AND file_type='json';


SELECT
  'card' AS component,
  (SELECT COALESCE(UPPER(SUBSTR(COALESCE(tool_name, ''), 1, 1)) || LOWER(SUBSTR(COALESCE(tool_name, ''), 2)),NULL) 
  FROM uniform_resource_content WHERE uniform_resource_id = @id) || ' Markdown Details' AS title
  WHERE EXISTS ( SELECT 1 FROM uniform_resource_content
        WHERE uniform_resource_id = @id AND file_type = 'markdown'
  );

SELECT
  content AS description_md,
  12 width
FROM uniform_resource
WHERE uniform_resource_id = @id
  AND json_valid(content) = 0;
```



## Interpretation

```sql interpretation/penetration-report.sql { route: { caption: "", layout: "fluid" }}

WITH template AS (
  SELECT '
## {title}

**Status:** {status}  
**Priority:** {priority_colored}  
**Assignee(s):** {assignee}  
**Label:** {label}  
**Dependencies:** {dependencies}  
**Created:** {created}  

### Description
{body}

### Parameter Affected
{param}

### Steps Reproduced
{steps}

### Business Impact
{impact}

### Recommendation
{recommendation}

### Reference
{reference}
' AS tpl
),

data AS (
  SELECT
    REPLACE(
      REPLACE(
        REPLACE(
          REPLACE(
            REPLACE(
              REPLACE(
                REPLACE(
                  REPLACE(
                    REPLACE(
                      REPLACE(
                        REPLACE(
                          REPLACE(
                            REPLACE(t.tpl,
                              '{title}', it.title
                            ),
                            '{status}', UPPER(COALESCE(it.status,'-'))
                          ),
                          '{priority_colored}',
                          CASE LOWER(it.priority)
                            WHEN 'critical' THEN 'CRITICAL'
                            WHEN 'high'     THEN 'HIGH'
                            WHEN 'medium'   THEN 'MEDIUM'
                            WHEN 'low'      THEN 'LOW'
                            ELSE ''
                          END
                        ),
                        '{assignee}', COALESCE(it.assignee,'-')
                      ),
                      '{label}', COALESCE(it.label,'-')
                    ),
                    '{dependencies}', COALESCE(it.dependencies,'-')
                  ),
                  '{created}', COALESCE(it.created_date,'-')
                ),
                '{body}', COALESCE(it.description,'-')
              ),
              '{param}', COALESCE(it.parameter_affected,'-')
            ),
            '{steps}', COALESCE(it.steps_reproduced,'-')
          ),
          '{impact}', COALESCE(it.bussiness_impact,'-')
        ),
        '{recommendation}', COALESCE(it.recommentation,'-')
      ),
      '{reference}', COALESCE(it.reference,'-')
    ) AS block_md
  FROM interpretaion_task_master it
  CROSS JOIN template t
  WHERE it.tenant  = COALESCE(:Tenant, sqlpage.cookie('Tenant'))
    AND it.session = COALESCE(:Session, sqlpage.cookie('Session'))
  ORDER BY
    CASE LOWER(it.priority)
      WHEN 'critical' THEN 1
      WHEN 'high'     THEN 2
      WHEN 'medium'   THEN 3
      WHEN 'low'      THEN 4
      ELSE 5
    END
)

SELECT
  'text' AS component,
  'penetration-report-content' AS id,
  'printable-report' AS class,

'
## Criteria for Risk Ratings

- **CRITICAL** ‚Äì These issues can allow attackers to execute code on the web application or application server, or access sensitive data. Examples of high-risk issues include SQL injections, remote code execution, and command injection.
- **HIGH** ‚Äì These issues will allow malicious attackers to access application resources and data. This can allow an attacker to steal session information or sensitive data from the application or server. Examples of high-risk issues include known LFI, XSS, buffer overflows, unauthorized access, and disclosure of sensitive information.
- **MEDIUM** ‚Äì These issues identify conditions that do not immediately or directly result in compromise of a network, system, application, or information, but do provide information that could be used in combination with other information to gain insight into how to compromise or gain unauthorized access to a network, system, application, or information.
- **LOW** ‚Äì Vulnerabilities in the low range typically have very little impact on an organization‚Äôs business. Exploitation of such vulnerabilities usually requires local or physical system access.
- **INFO** ‚Äì An informational severity level typically indicates findings that do not directly impact the security of the application but provide useful information.
- **REMEDIATED** ‚Äì The issue has been fixed since the previous round of penetration testing.
- **NOT REMEDIATED** ‚Äì The issue has not been fixed.
'
||
COALESCE(
  (SELECT group_concat(block_md, '\n') FROM data),
  ''
)
AS contents_md;


```

```sql interpretation/modal.sql   { route: { caption: "", layout: "fluid" } }

select 
  'form' as component,
  'save' as validate,
  'btn-custom' as class,
  '/interpretation/modal.sql' AS action;

 SELECT
    'input' as type,
    'Title' as name,
    COALESCE(
      :Title,
      (
        SELECT title
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    12  as width,
    TRUE  as required;

 SELECT 
    'Priority'  as name,
    'select'    as type,
     COALESCE(
      :Priority,
      (
        SELECT priority
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    '[
      {"label": "Critical", "value": "Critical"},
      {"label": "High", "value": "High"},
      {"label": "Medium", "value": "Medium"},
      {"label": "Low", "value": "Low"}
    ]' as options,
    TRUE  as required,
    4  as width;

  SELECT 
  'Status' AS name,
  'select' AS type,
  COALESCE(
    :Status,
    (
      SELECT status
      FROM interpretaion_task_master
      WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
    )
  ) AS value,
  '[
    {"label":"Not Remediated","value":"not-remediated"},
    {"label":"In Progress","value":"inprogress"},
    {"label":"Remediated","value":"remediated"}
  ]' AS options,
  TRUE AS required,
  4 AS width;

     SELECT
    'input' as type,
    'Assignee' as name,
     COALESCE(
      :Assignee,
      (
        SELECT assignee
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    TRUE  as required,
    4  as width;

     SELECT
    'input' as type,
    'Cwe' as name,
    'CWE (Common Weakness Enumeration)' as label,
    COALESCE(
      :Cwe,
      (
        SELECT cwe
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4  as width;

  SELECT
    'input' as type,
    'Cve' as name,
    'CVE (Common Vulnerabilities and Exposures)' as label,
    COALESCE(
      :Cve,
      (
        SELECT cve
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4  as width;

     SELECT
    'select' as type,
    'Dependancies' as name,
     COALESCE(
      :Dependancies,
      (
        SELECT dependencies
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    'Select dependency' AS empty_option,
    json_group_array(
      json_object(
        'label', title,
        'value', title
      )
    ) AS options,
    'Type Task ID or title' as placeholder,
    4  as width
    FROM interpretaion_task_master
    WHERE tenant  = COALESCE(:Tenant, sqlpage.cookie('Tenant'))
    AND session = COALESCE(:Session, sqlpage.cookie('Session'));

  SELECT
    'input' as type,
    'Owasp' as name,
    'OWASP Security Standard' as label,
    COALESCE(
      :Owasp,
      (
        SELECT owasp
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4  as width;

    SELECT
    'input' as type,
    'Nist' as name,
    'National Institute of Standard and Technology (NIST)' as label,
    COALESCE(
      :Nist,
      (
        SELECT nist
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4  as width;

  SELECT
    'input' as type,
    'Mitre' as name,
    'MITRE ATT&CK' as label,
    COALESCE(
      :Mitre,
      (
        SELECT mitre
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4  as width;

  SELECT
  'Labels[]' AS name,
  'select' AS type,
  'Labels' AS label,
  TRUE AS multiple,
  json_group_array(
    json_object(
      'label', o.label,
      'value', o.value,
      'selected',
        EXISTS (
          SELECT 1
          FROM interpretaion_task_master t,
               json_each(t.label)
          WHERE t.uniform_resource_id = sqlpage.cookie('uniform_resource_id')
            AND json_each.value = o.value
        )
    )
  ) AS options,
  TRUE AS required,
  4 AS width
FROM (
  SELECT 'Human Detected' AS label, 'human-detected' AS value UNION ALL
  SELECT 'Human Verifiable', 'human-verifiable' UNION ALL
  SELECT 'Machine Detectable', 'machine-detectable' UNION ALL
  SELECT 'Machine Reasonable', 'machine-reasonable' UNION ALL
  SELECT 'LLM Detectable', 'llm-detectable' UNION ALL
  SELECT 'LLM Reasonable', 'llm-reasonable'
) o;

  SELECT
    'textarea' AS type,
    'Description' AS name,
    COALESCE(
      :Description,
      (
        SELECT description
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    'rich-text-editor' AS class,
    'Use toolbar to format text, insert links, images, lists, etc.' AS help,
    true as required,
    $disabled is not null as disabled;

  SELECT
    'textarea' AS type,
    'Parameter Affected' AS label,
    'Parameter' AS name,
    COALESCE(
      :Parameter,
      (
        SELECT parameter_affected
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    2 AS rows,
     'rich-text-editor' AS class,
    'Use toolbar to format text, insert links, images, lists, etc.' AS help,
    true as required,
    8  as width;

  SELECT
    'textarea' AS type,
    'Steps to Reproduce' AS label,
    'StepsToReproduce' AS name,
    COALESCE(
      :StepsToReproduce,
      (
        SELECT steps_reproduced
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4 AS rows,
     'rich-text-editor' AS class,
    'Use toolbar to format text, insert links, images, lists, etc.' AS help,
    true as required,
    8  as width;

  SELECT
    'textarea' AS type,
    'Business Impact' AS label,
    'BusinessImpact' AS name,
    COALESCE(
      :BusinessImpact,
      (
        SELECT bussiness_impact
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4 AS rows,
     'rich-text-editor' AS class,
    'Use toolbar to format text, insert links, images, lists, etc.' AS help,
    true as required,
    12  as width;

  SELECT
    'textarea' AS type,
    'Recommendation' AS name,
    COALESCE(
      :Recommendation,
      (
        SELECT recommentation
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4 AS rows,
     'rich-text-editor' AS class,
    'Use toolbar to format text, insert links, images, lists, etc.' AS help,
    true as required,
    12  as width;

  SELECT
    'textarea' AS type,
    'Reference' AS name,
    COALESCE(
      :Reference,
      (
        SELECT reference
        FROM interpretaion_task_master
        WHERE uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      )
    ) AS value,
    4 AS rows,
    TRUE  as required,
    12  as width;

    SELECT
      sqlpage.run_sql('interpretation/save.sql') AS ignored
    WHERE 1 = 0;

```

```sql interpretation/save.sql { route: { caption: "", layout: "fluid" } }
      INSERT INTO interpretaion_task_master (
      tenant,
      session,
      uniform_resource_id,
      title,
      description,
      status,
      priority,
      created_date,
      assignee,
      dependencies,
      parameter_affected,
      steps_reproduced,
      bussiness_impact,
      recommentation,
      reference,
      label,
      category,
      owasp,
      cwe,
      cve,
      nist,
      mitre
  )
  SELECT
      COALESCE(:Tenant, sqlpage.cookie('Tenant')),
      COALESCE(:Session, sqlpage.cookie('Session')),
      sqlpage.cookie('uniform_resource_id'),
      :Title,
      :Description,
      :Status,
      :Priority,
      datetime('now'),
      :Assignee,
      :Dependancies,
      :Parameter,
      :StepsToReproduce,
      :BusinessImpact,
      :Recommendation,
      :Reference,
      :Labels,
      :Category,
      :Owasp,
      :Cwe,
      :Cve,
      :Nist,
      :Mitre

  WHERE
      :Title IS NOT NULL 
      AND NOT EXISTS (
          SELECT 1
          FROM interpretaion_task_master t
          WHERE t.uniform_resource_id =  sqlpage.cookie('uniform_resource_id')
  );
  
  UPDATE interpretaion_task_master
  SET
      title       = COALESCE(:Title, title),
      description = COALESCE(:Description, description),
      status      = COALESCE(:Status, status),
      priority    = COALESCE(:Priority, priority),
      assignee    = COALESCE(:Assignee, assignee),
      dependencies = COALESCE(:Dependancies, dependencies),
      parameter_affected       = COALESCE(:Parameter, parameter_affected),
      steps_reproduced       = COALESCE(:StepsToReproduce, steps_reproduced),
      bussiness_impact       = COALESCE(:BusinessImpact, bussiness_impact),
      recommentation       = COALESCE(:Recommendation, recommentation),
      reference    = COALESCE(:Reference, reference),
      label = COALESCE(:Labels, label),
      category = COALESCE(:Category, category),
      owasp = COALESCE(:Owasp, owasp),
      cwe = COALESCE(:Cwe, cwe),
      cve = COALESCE(:Cve, cve),
      nist = COALESCE(:Nist, nist),
      mitre = COALESCE(:Mitre, mitre)
  WHERE
      uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      AND EXISTS (
          SELECT 1
          FROM interpretaion_task_master t
          WHERE t.uniform_resource_id = sqlpage.cookie('uniform_resource_id')
      );
```

```sql interpretation/delete-confirmation.sql   { route: { caption: "", layout: "fluid" } }
select 
    'text'              as component,
    'Are you sure want to delete?' as contents;
    
select 
    'button' as component,
    'end' as justify;
select 
    'No' as title,
    'danger' as outline;
select 
    'Yes' as title,
     '/interpretation/delete.sql?uid='|| @uid ||'' as link,
    'success' as outline;
```

```sql interpretation/delete.sql   { route: { caption: "", layout: "fluid" } }

DELETE FROM interpretaion_task_master
WHERE uniform_resource_id = @uid;

```

```sql threatmanagement/interpretations.sql { route: { caption: "Interpretation", layout: "fluid" } }

select 
    'divider'            as component,
    'Interpretation' as contents,
    'fs-3' as class,
    'blue'               as color;


-- ===== Interpretation  =====
SELECT 
  'title' AS component, 
  'Interpretation' AS contents;

SELECT 
  'text' AS component, 
  'This section presents interpretations derived from the overall findings, summarizing key issues in a clear and actionable manner. Each interpretation provides a simplified description of the problem, its assigned priority, and the responsible team or individual. It also notes the specific parameters affected by the vulnerability, along with recommended remediation steps. Reference URLs are included to offer additional guidance and technical context. Some interpretations also highlight dependencies, linking related issues identified elsewhere in the findings. By consolidating this information, the section helps teams understand, prioritize, and address vulnerabilities efficiently.' AS contents;

select 
    'modal'            as component,
    'inter_edit_modal'      as id,
    'modal-custom'     as class,
    'Edit Interpretation' AS title,
    TRUE as large,
   '/interpretation/modal.sql' as embed;

SELECT 
  'foldable' AS component,
  'foldable-custom' AS class;

WITH template AS (
  SELECT
'
[**Edit**](?uid={uid}#inter_edit_modal)

---

**Status:** {status}  
**Priority:** {priority}  
**Assignee(s):** {assignee}  
**Label:** {label}  
**Dependencies:** {dependencies}  
**Created:** {created}  

---

### Description
{body}

### Parameter Affected
{param}

### Steps Reproduced
{steps}

### Business Impact
{impact}

### Recommendation
{recommendation}

### Reference
{reference}
' AS tpl
),

data AS (
  SELECT
    it.title,

    REPLACE(
      REPLACE(
        REPLACE(
          REPLACE(
            REPLACE(
              REPLACE(
                REPLACE(
                  REPLACE(
                  REPLACE(
                    REPLACE(
                      REPLACE(
                        REPLACE(
                          REPLACE(t.tpl,
                            '{uid}', it.uniform_resource_id
                          ),
                          '{status}', 
                          UPPER(SUBSTR(COALESCE(it.status,''),1,1)) ||
                          LOWER(SUBSTR(COALESCE(it.status,''),2))
                        ),
                        '{priority}', UPPER(COALESCE(it.priority,'-'))
                      ),
                      '{assignee}', COALESCE(it.assignee,'-')
                    ),
                      '{label}',COALESCE(
                        (
                          SELECT group_concat(
                            trim(
                              replace(
                                replace(
                                  upper(substr(word, 1, 1)) || substr(word, 2),
                                  'Llm ',
                                  'LLM '
                                ),
                                ' ', ' '
                              )
                            ),
                            ', '
                          )
                          FROM (
                            SELECT
                              replace(value, '-', ' ') AS word
                            FROM json_each(it.label)
                          )
                        ),
                        '-'
                      )
                    ),
                    '{dependencies}', COALESCE(it.dependencies,'-')
                  ),
                  '{created}', COALESCE(it.created_date,'-')
                ),
                '{body}', COALESCE(it.description,'-')
              ),
              '{param}', COALESCE(it.parameter_affected,'-')
            ),
            '{steps}', COALESCE(it.steps_reproduced,'-')
          ),
          '{impact}', COALESCE(it.bussiness_impact,'-')
        ),
        '{recommendation}', COALESCE(it.recommentation,'-')
      ),
      '{reference}', COALESCE(it.reference,'-')
    ) AS description_md

  FROM interpretaion_task_master it
  CROSS JOIN template t
  WHERE (NULLIF(@uid, '') IS NULL OR it.uniform_resource_id = @uid) 
    AND it.tenant  = COALESCE(:Tenant, sqlpage.cookie('Tenant'))
    AND it.session = COALESCE(:Session, sqlpage.cookie('Session'))
)

SELECT
  title,
  description_md
FROM data
ORDER BY title;
```
